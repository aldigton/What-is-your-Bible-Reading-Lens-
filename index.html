<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>How Do You Really See the Bible?</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
    <style>
        /* Base styles */
        :root {
            --color-primary: #1e40af; /* Blue-800 */
            --color-accent: #3b82f6; /* Blue-500 */
            --color-success: #10b981; /* Emerald-500 */
            --color-bg: #f3f4f6;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--color-bg);
            /* Ensure text contrast for accessibility on body */
            color: #1f2937; 
        }
        
        /* Utility Classes */
        .shadow-3xl {
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.1);
        }

        /* Animations */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-fadeIn {
            animation: fadeIn 0.4s ease-out;
        }
        @keyframes slideIn {
            from { opacity: 0; transform: translateX(10px); }
            to { opacity: 1; transform: translateX(0); }
        }
        .animate-slideIn {
            animation: slideIn 0.3s ease-out;
        }

        /* Accessibility: Ensure buttons have a clear focus ring (WCAG compliance) */
        .answer-btn:focus, #start-btn:focus, #retake-btn:focus {
            outline: 3px solid var(--color-accent);
            outline-offset: 2px;
        }

        /* Enforce high contrast for buttons */
        .answer-btn {
             color: #374151; /* Gray-700 */
        }
    </style>
</head>
<body class="min-h-screen flex items-center justify-center p-4">

    <!-- Container for Quiz -->
    <div role="main" class="max-w-xl w-full bg-white p-8 md:p-10 rounded-2xl shadow-3xl text-center animate-fadeIn my-10" id="quiz-wrapper">

        <!-- START SCREEN -->
        <div id="start-screen" aria-live="polite">
            <div class="text-6xl text-gray-400 mb-6" aria-hidden="true">üìö</div>
            <h1 class="text-3xl font-extrabold text-gray-900 mb-3 leading-tight">
                How Do You <em class="text-blue-600">Really</em> See the Bible?
            </h1>
            <p class="text-lg text-gray-700 mb-6">
                This short quiz helps identify the "lens" you instinctively use when reading and interpreting Scripture.
            </p>

            <div class="flex flex-wrap justify-center gap-3 mb-8">
                <span class="px-3 py-1 bg-blue-100 text-blue-800 rounded-full text-sm font-semibold">10 Questions</span>
                <span class="px-3 py-1 bg-blue-100 text-blue-800 rounded-full text-sm font-semibold">5 Reading Lenses</span>
                <span class="px-3 py-1 bg-blue-100 text-blue-800 rounded-full text-sm font-semibold">Private & Secure</span>
            </div>

            <button id="start-btn" class="w-full py-4 bg-blue-600 text-white font-bold rounded-xl text-lg shadow-lg hover:bg-blue-700 transition duration-150 transform hover:-translate-y-0.5" aria-label="Start the Bible reading style quiz">
                Start the Quiz
            </button>
        </div>

        <!-- QUIZ SCREEN -->
        <div id="quiz-container" class="hidden text-left" aria-live="polite" aria-relevant="all">
            <div class="flex justify-between items-center mb-6">
                <div class="text-sm font-semibold text-gray-700" id="progress-text" aria-live="off">Question 1 of 10</div>
                <div class="w-full ml-4 h-2 bg-gray-200 rounded-full overflow-hidden" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="10">
                    <div id="progress-fill" class="h-full bg-blue-500 transition-all duration-300 ease-in-out" style="width: 0%"></div>
                </div>
            </div>

            <div id="question-card" class="animate-slideIn">
                <p class="text-xl font-semibold text-gray-800 mb-8" id="q-text" role="status">Loading...</p>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <button class="answer-btn px-6 py-4 bg-white border-2 border-gray-200 text-gray-700 font-medium rounded-xl hover:border-blue-500 hover:text-blue-600 transition duration-150" data-choice="yes" role="button" aria-label="Answer yes to the current question">
                        YES, I agree
                    </button>
                    <button class="answer-btn px-6 py-4 bg-white border-2 border-gray-200 text-gray-700 font-medium rounded-xl hover:border-blue-500 hover:text-blue-600 transition duration-150" data-choice="no" role="button" aria-label="Answer no to the current question">
                        NO, I disagree
                    </button>
                </div>
            </div>
        </div>

        <!-- RESULT SCREEN -->
        <div id="result-section" class="hidden text-left animate-fadeIn" aria-live="polite">
            <div class="mb-4">
                <span id="res-tag" class="inline-block px-4 py-1 bg-blue-100 text-blue-800 text-xs font-bold uppercase tracking-wider rounded-full">Your Reading Lens</span>
                <h1 id="res-title" class="text-3xl font-extrabold text-gray-900 mt-2 mb-4 leading-tight">...</h1>
            </div>

            <div id="res-body" class="bg-blue-50 border-l-4 border-blue-600 p-6 rounded-xl text-gray-700 text-base">
                ...
            </div>

            <div class="mt-8 pt-4 border-t border-gray-200">
                <h3 class="text-lg font-semibold text-gray-800 mb-3">Your Responses Summary</h3>
                <div id="answers-summary" class="space-y-3 text-sm max-h-60 overflow-y-auto pr-2" tabindex="0">
                    <!-- Summary items will go here -->
                </div>
            </div>

            <button id="retake-btn" class="w-full py-3 mt-8 bg-emerald-500 text-white font-bold rounded-xl shadow-md hover:bg-emerald-600 transition duration-150" aria-label="Start the quiz over again">
                Start Over
            </button>
        </div>

        <div class="text-xs text-gray-500 mt-6">
            Disclaimer: This quiz is for self-reflection and discussion, not for definitive theological labeling.
        </div>
    </div>

    <script>
        (function () {
            'use strict';
            
            console.log("Quiz Logic: V16 (Gap Fixes) Loaded");

            try {
                const questions = [
                    // TEXT LENS
                    { id: 1, text: "The meaning of a Bible passage should be based on its original time and setting.", axis: "text" },
                    { id: 2, text: "The meaning intended by the original author must control how we interpret a passage.", axis: "text" },
                    { id: 3, text: "The way an author wrote a Bible passage (as a story, a song, or a letter) decides its main message and how we should understand it.", axis: "text" },
                    { id: 4, text: "When the Bible uses figurative language (like metaphors), its true meaning should still be determined by the original author's intended message.", axis: "text" },

                    // REALITY LENS
                    { id: 5, text: "I believe the Resurrection of Jesus was a real, physical, historical event involving His actual body.", axis: "reality_res" },
                    { id: 6, text: "The Bible may contain statements that only show what people believed about nature a long time ago.", axis: "reality_sci" },

                    // AUTHORITY LENS
                    { id: 7, text: "Scripture is the only trustworthy source for doctrine and practice, and no other human authority can add to it.", axis: "auth_bible" },
                    { id: 8, text: "Church Tradition (history, councils) helps fully interpret the Bible and carries equal authority for our faith.", axis: "auth_trad" },
                    { id: 9, text: "The Holy Spirit gives new, binding guidance or prophecy to the church today.", axis: "auth_prophecy" },
                    { id: 10, text: "God gives me personal meanings for verses that can differ from their original, intended meaning.", axis: "auth_personal" }
                ];

                const resultsData = {
                    clear: {
                        title: "The Clear Text Lens", emoji: "üìñ", color: "blue",
                        body: `
                            <p class="font-bold mb-2">You view Scripture through a <strong>Microscope</strong>.</p>
                            <p>You scored high on prioritizing **Textual Rigor** and **Scripture Alone**. You see the Bible as a stable, self-interpreting anchor whose meaning is fixed by the author. Your method is the most conservative and rigorous in seeking the historical, plain meaning of the text.</p>
                            <p class="mt-3 font-semibold">Your Challenge: Rigidity. Be sure your focus on the "inwards" text does not prevent real-world application or create unnecessary conflict with established scientific/historical facts.</p>
                        `
                    },
                    living: {
                        title: "The Living Lens", emoji: "üïäÔ∏è", color: "purple",
                        body: `
                            <p class="font-bold mb-2">You view Scripture through a <strong>Wide-Angle Lens</strong>.</p>
                            <p>You don't just look at the page; you look at the community and the Spirit around it. Your lens captures the Bible as part of a larger, living conversation‚Äîwhether that's ancient Church Tradition or the fresh voice of Prophecy. You see God as still speaking today.</p>
                            <p class="mt-3 font-semibold">Your Blind Spot: Distortion. With such a wide view, ensure that new experiences or traditions don't blur or contradict the sharp, fixed meaning of the original text.</p>
                        `
                    },
                    modern: {
                        title: "The Modern Lens", emoji: "üî¨", color: "green",
                        body: `
                            <p class="font-bold mb-2">You view Scripture through a <strong>Bifocal Lens</strong>.</p>
                            <p>You have a unique ability to look at two things at once. One part of your lens focuses on the ancient human context (admitting they didn't know modern science), while the other part focuses on the eternal spiritual truth. You see the Bible as fully divine but also fully human.</p>
                            <p class="mt-3 font-semibold">Your Blind Spot: Separation. The challenge with bifocals is keeping the image whole. Be careful not to separate the "human" parts so much that you lose sight of the supernatural power (like the Resurrection).</p>
                        `
                    },
                    cultural: {
                        title: "The Nominal Lens", emoji: "üïØÔ∏è", color: "gray",
                        body: "PLACEHOLDER"
                    }
                };

                let currentQIndex = 0;
                let answers = {};
                let isAnimating = false;

                function setSafeHTML(element, htmlContent) {
                    const tempDiv = document.createElement('div');
                    tempDiv.innerHTML = htmlContent;
                    tempDiv.querySelectorAll('script, iframe, object, embed, form, style, link, meta').forEach(el => el.remove());
                    element.innerHTML = tempDiv.innerHTML;
                }

                function init() {
                    const startBtn = document.getElementById('start-btn');
                    const retakeBtn = document.getElementById('retake-btn');
                    const answerBtns = document.querySelectorAll('.answer-btn');

                    startBtn.addEventListener('click', startQuiz);
                    retakeBtn.addEventListener('click', restartQuiz);
                    answerBtns.forEach(btn => {
                        btn.addEventListener('click', () => {
                            if (!isAnimating) {
                                const choice = btn.getAttribute('data-choice');
                                handleAnswer(choice);
                            }
                        });
                    });
                    document.addEventListener('DOMContentLoaded', () => {
                        const card = document.getElementById('question-card');
                        if (card) {
                            card.classList.remove('animate-slideIn');
                            void card.offsetWidth; 
                            card.classList.add('animate-slideIn');
                        }
                    });
                }

                function startQuiz() {
                    document.getElementById('start-screen').classList.add('hidden');
                    document.getElementById('quiz-container').classList.remove('hidden');
                    currentQIndex = 0;
                    answers = {};
                    renderQuestion();
                }

                function restartQuiz() {
                    document.getElementById('result-section').classList.add('hidden');
                    document.getElementById('start-screen').classList.remove('hidden');
                    window.scrollTo(0, 0);
                    currentQIndex = 0;
                    answers = {};
                }

                function renderQuestion() {
                    if (currentQIndex >= questions.length) {
                        calculateResult();
                        return;
                    }

                    const q = questions[currentQIndex];
                    const progressPercent = ((currentQIndex) / questions.length) * 100;

                    document.getElementById('progress-fill').style.width = progressPercent + '%';
                    document.getElementById('progress-text').textContent =
                        `Question ${currentQIndex + 1} of ${questions.length}`;
                    
                    const progressBar = document.querySelector('[role="progressbar"]');
                    if (progressBar) {
                        progressBar.setAttribute('aria-valuenow', currentQIndex + 1);
                    }

                    const card = document.getElementById('question-card');
                    isAnimating = true;
                    card.classList.remove('animate-slideIn');
                    setTimeout(() => {
                        card.classList.add('animate-slideIn');
                        document.getElementById('q-text').textContent = q.text;
                        isAnimating = false;
                    }, 10);
                }
                
                function finalizeProgress() {
                     document.getElementById('progress-fill').style.width = '100%';
                     document.getElementById('progress-text').textContent = 'Quiz Complete';
                     const progressBar = document.querySelector('[role="progressbar"]');
                     if (progressBar) {
                         progressBar.setAttribute('aria-valuenow', questions.length);
                     }
                }

                function handleAnswer(choice) {
                    const currentQ = questions[currentQIndex];
                    answers[currentQ.id] = choice;
                    
                    if (currentQ.id === 5 && choice === 'no') { 
                        currentQIndex = questions.length; 
                        for (let i = 5; i < 10; i++) {
                            const skippedQId = questions[i].id;
                            if (answers[skippedQId] === undefined) {
                                answers[skippedQId] = '-'; 
                            }
                        }
                        finalizeProgress();
                        calculateResult();
                        return;
                    }

                    currentQIndex++;
                    if (currentQIndex === questions.length) {
                        finalizeProgress();
                    }
                    renderQuestion();
                }

                // --- SCORING LOGIC (Final Logic V16 - Gap Fixes) ---

                function calculateResult() {
                    let textScore = 0; 
                    let authScore = 0; 
                    
                    const isYes = (id) => answers[id] === 'yes';
                    const isNo = (id) => answers[id] === 'no';

                    questions.forEach(q => {
                        if (isYes(q.id)) {
                            switch (q.axis) {
                                case 'text': textScore++; break;
                                case 'auth_trad':
                                case 'auth_prophecy':
                                case 'auth_personal': authScore++; break;
                            }
                        }
                    });
                    
                    const resurrectionDenied = isNo(5) && answers[5] !== '-';
                    const q7Yes = isYes(7) ? 1 : 0;
                    const q6Yes = isYes(6) ? 1 : 0;
                    const q5Yes = isYes(5) ? 1 : 0;

                    // --- Logic V16 Updates ---
                    // 1. Calculate Purity Bonus (Q7) Conditionally
                    let purityBonus = 0;
                    if (q7Yes) {
                        // Fix 1: Must have text rigor (textScore >= 2)
                        // Fix 2: Must NOT have conflicting authority (authScore == 0)
                        if (textScore >= 2 && authScore === 0) {
                            purityBonus = 7; 
                        } else {
                            purityBonus = 0; // Void the bonus if contradictory or uneducated
                        }
                    }

                    // --- Affinity Calculation ---

                    // Clear Text Affinity
                    let clearAffinity = (3 * textScore) + purityBonus - (3 * authScore) - (2 * q6Yes);
                    if (resurrectionDenied) clearAffinity -= 12;
                    
                    // Living Affinity
                    let livingAffinity = 0;
                    if (authScore > 0) {
                        livingAffinity = 6 + (3 * authScore) + textScore;
                    }
                    
                    // Modern Affinity
                    let modernAffinity = (2 * textScore) + (6 * q6Yes) + (2 * q5Yes);
                    if (!q6Yes) modernAffinity -= 4; 
                    if (resurrectionDenied) modernAffinity -= 8;
                    
                    // Cultural Affinity
                    let culturalAffinity = (2 * (4 - textScore)) + 4;
                    if (resurrectionDenied) culturalAffinity += 8;

                    // V15 Undefined Profile Catch (Still needed)
                    if (textScore >= 3 && !q7Yes && !q6Yes && authScore === 0) {
                        culturalAffinity += 12; 
                    }
                    
                    const affinityScores = {
                        clear: clearAffinity,
                        living: livingAffinity,
                        modern: modernAffinity,
                        cultural: culturalAffinity
                    };

                    let outcomeKey = 'clear';
                    let maxScore = -Infinity;
                    
                    const keys = ['modern', 'living', 'clear', 'cultural']; 
                    
                    for (const key of keys) {
                        if (affinityScores[key] > maxScore) {
                            maxScore = affinityScores[key];
                            outcomeKey = key;
                        } 
                    }
                    
                    displayResult(outcomeKey);
                }

                function displayResult(key) {
                    document.getElementById('quiz-container').classList.add('hidden');
                    document.getElementById('result-section').classList.remove('hidden');
                    window.scrollTo(0, 0);

                    const summaryEl = document.getElementById('answers-summary');
                    let recapHTML = '';

                    questions.forEach((q, index) => {
                        const val = answers[q.id];
                        const isAnswered = val !== undefined && val !== '-'; 
                        const displayOutput = isAnswered ? val.toUpperCase() : 'SKIPPED';
                        const choiceColor = isAnswered ? (val === 'yes' ? 'text-blue-600 font-semibold' : 'text-gray-500') : 'text-red-500 font-semibold';

                        recapHTML += `
                            <div class="flex justify-between items-start border-b border-gray-100 pb-2">
                                <span class="text-gray-700 w-3/4 pr-2">${index + 1}. ${q.text}</span>
                                <span class="${choiceColor} text-right w-1/4">${displayOutput}</span>
                            </div>
                        `;
                    });

                    setSafeHTML(summaryEl, recapHTML);

                    // --- DYNAMIC RESULTS ---
                    let data = { ...resultsData[key] };

                    if (key === 'cultural') {
                        if (answers[5] === 'no') {
                            // 5. THE SKEPTIC LENS
                            data.title = "The Skeptic Lens";
                            data.body = `
                                <p class="font-bold mb-2">You view Scripture through a <strong>Museum Lens</strong>.</p>
                                <p>You see the Bible as a fascinating artifact of history or culture, but you observe it from a distance. By rejecting the Resurrection, you are analyzing the text as a human invention rather than a living, authoritative voice.</p>
                                <p class="mt-3 font-semibold">Your Blind Spot: Detachment. You may understand the history well, but you are missing the transformative power that comes from stepping inside the story and believing it.</p>
                            `;
                        } else {
                            // 2. THE NOMINAL LENS (Casual/Undefined)
                            data.title = "The Nominal Lens";
                            data.body = `
                                <p class="font-bold mb-2">You view Scripture through a <strong>Soft-Focus Lens</strong>.</p>
                                <p>You see the Bible primarily as a source of comfort or inspiration, but you may not have a clearly defined method for interpreting it. You might score high on reading rules but hesitate to commit to a specific theological framework (like Scripture Alone or Tradition).</p>
                                <p class="mt-3 font-semibold">Your Blind Spot: Definition. A soft focus feels safe, but it can miss the author's specific point. Consider asking: "What is my final authority?" to bring your reading into sharper focus.</p>
                            `;
                        }
                    }
                    
                    document.getElementById('res-title').textContent = data.title;
                    setSafeHTML(document.getElementById('res-body'), data.body);

                    const tagEl = document.getElementById('res-tag');
                    const bodyEl = document.getElementById('res-body');

                    tagEl.className = 'inline-block px-4 py-1 text-xs font-bold uppercase tracking-wider rounded-full';
                    bodyEl.className = 'p-6 rounded-xl text-gray-700 text-base border-l-4';

                    let tagColor, borderColor;
                    switch (data.color) {
                        case 'blue': tagColor = 'bg-blue-100 text-blue-800'; borderColor = 'border-blue-600 bg-blue-50'; break;
                        case 'purple': tagColor = 'bg-purple-100 text-purple-800'; borderColor = 'border-purple-600 bg-purple-50'; break;
                        case 'green': tagColor = 'bg-green-100 text-green-800'; borderColor = 'border-green-600 bg-green-50'; break;
                        case 'gray': tagColor = 'bg-gray-100 text-gray-800'; borderColor = 'border-gray-600 bg-gray-50'; break;
                    }
                    
                    tagEl.textContent = `${data.emoji} Your Reading Lens`;
                    tagEl.classList.add(...tagColor.split(' '));
                    bodyEl.classList.add(...borderColor.split(' '));
                }

                document.addEventListener('DOMContentLoaded', init);

            } catch (error) {
                console.error("Quiz Initialization Error:", error);
                const wrapper = document.getElementById('quiz-wrapper');
                if (wrapper) {
                    wrapper.innerHTML = '<div class="text-red-600 p-8">An unexpected error occurred during quiz setup. Please check the console for details.</div>';
                }
            }
        })();
    </script>
</body>
</html>
